<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Personagens - Demon Slayer RPG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Outfit:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #141419;
            --accent-red: #d90429;
            --accent-gold: #ffd700;
            --accent-purple: #9d4edd;
            --accent-cyan: #00b4d8;
            --border-color: rgba(255, 255, 255, 0.1);
            --font-display: 'Cinzel', serif;
            --font-main: 'Outfit', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background: #000;
            color: white;
            min-height: 100vh;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: var(--font-display);
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .logo i {
            color: var(--accent-red);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: white;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-red), #9d4edd);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        .header {
            margin-bottom: 3rem;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 2.5rem;
        }

        .header h1 span {
            color: var(--accent-red);
        }

        .char-count {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.5);
            margin-left: 1rem;
        }

        .header p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
        }

        .create-new-btn {
            background: linear-gradient(90deg, var(--accent-red), #c1121f);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(217, 4, 41, 0.4);
        }

        .create-new-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 4, 41, 0.6);
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .char-card {
            background: linear-gradient(135deg, rgba(20, 20, 25, 0.9) 0%, rgba(10, 10, 15, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .char-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-red);
            box-shadow: 0 12px 40px rgba(217, 4, 41, 0.3);
        }

        .char-card.active {
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(0, 180, 216, 0.3);
        }

        .char-card.active::before {
            content: 'ATIVO';
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--accent-cyan);
            color: #000;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            z-index: 2;
        }

        .char-header {
            padding: 2rem;
            background: linear-gradient(135deg, rgba(217, 4, 41, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .char-name {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .char-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .char-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .char-body {
            padding: 2rem;
        }

        .char-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            font-family: var(--font-display);
            color: var(--accent-cyan);
        }

        .char-breathing {
            background: rgba(157, 78, 221, 0.1);
            border: 1px solid rgba(157, 78, 221, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .char-breathing i {
            color: var(--accent-purple);
        }

        .char-breathing-text {
            flex: 1;
        }

        .char-breathing-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
        }

        .char-breathing-name {
            font-weight: 700;
            color: var(--accent-purple);
        }

        .char-actions {
            display: flex;
            gap: 1rem;
        }

        .char-btn {
            flex: 1;
            padding: 0.75rem;
            border-radius: 8px;
            border: none;
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .char-btn-primary {
            background: var(--accent-red);
            color: white;
        }

        .char-btn-primary:hover {
            background: #ff2a2a;
            transform: translateY(-2px);
        }

        .char-btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .char-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .char-btn-danger {
            background: rgba(217, 4, 41, 0.1);
            color: var(--accent-red);
            border: 1px solid rgba(217, 4, 41, 0.3);
        }

        .char-btn-danger:hover {
            background: rgba(217, 4, 41, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
        }

        .empty-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 2rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-icon i {
            color: rgba(255, 255, 255, 0.3);
        }

        .empty-title {
            font-family: var(--font-display);
            font-size: 2rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-text {
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 2rem;
        }

        .limit-warning {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .limit-warning i {
            color: var(--accent-gold);
            flex-shrink: 0;
        }

        .limit-warning-text {
            flex: 1;
        }

        .limit-warning-title {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .limit-warning-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .upgrade-link {
            color: var(--accent-gold);
            text-decoration: underline;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .characters-grid {
                grid-template-columns: 1fr;
            }

            .header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .char-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo" onclick="window.location.href='index.html'">
            <i data-lucide="flame" style="width:24px;"></i>
            Demon Slayer RPG
        </div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">In√≠cio</a>
            <a href="characters.html" class="nav-link" style="color: white;">Personagens</a>
            <a href="premium.html" class="nav-link">Premium</a>
            <a href="#" class="nav-link">Ranking</a>
            <div class="user-avatar">
                <i data-lucide="user" style="width:20px;"></i>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div>
                    <h1>Meus <span>Personagens</span> <span class="char-count" id="charCount">(0/5)</span></h1>
                    <p>Gerencie seus ca√ßadores de dem√¥nios e escolha quem entrar√° em a√ß√£o</p>
                </div>
                <button class="create-new-btn" onclick="createNewCharacter()" id="createBtn">
                    <i data-lucide="plus-circle" style="width:20px;"></i>
                    Criar Novo Personagem
                </button>
            </div>
        </div>

        <!-- Limit Warning -->
        <div id="limitWarning" style="display: none;"></div>

        <!-- Characters Grid -->
        <div class="characters-grid" id="charactersGrid">
            <!-- Characters will be injected here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="display: none;">
            <div class="empty-state">
                <div class="empty-icon">
                    <i data-lucide="users" style="width:50px; height:50px;"></i>
                </div>
                <h2 class="empty-title">Nenhum Personagem Criado</h2>
                <p class="empty-text">Comece sua jornada criando seu primeiro ca√ßador de dem√¥nios</p>
                <button class="create-new-btn" onclick="createNewCharacter()">
                    <i data-lucide="plus-circle" style="width:20px;"></i>
                    Criar Primeiro Personagem
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Load characters
        function loadCharacters() {
            try {
                const allChars = JSON.parse(localStorage.getItem('demonSlayerAllChars') || '[]');
                const activeChar = JSON.parse(localStorage.getItem('demonSlayerChar') || '{}');

                const grid = document.getElementById('charactersGrid');
                const emptyState = document.getElementById('emptyState');
                const charCount = document.getElementById('charCount');
                const createBtn = document.getElementById('createBtn');
                const limitWarning = document.getElementById('limitWarning');

                // Update count
                charCount.textContent = `(${allChars.length}/5)`;

                // Check limit
                if (allChars.length >= 5) {
                    createBtn.disabled = true;
                    createBtn.style.opacity = '0.5';
                    createBtn.style.cursor = 'not-allowed';

                    limitWarning.style.display = 'flex';
                    limitWarning.innerHTML = `
                        <i data-lucide="alert-circle" style="width:24px;"></i>
                        <div class="limit-warning-text">
                            <div class="limit-warning-title">Limite de Personagens Atingido</div>
                            <div class="limit-warning-desc">
                                Voc√™ atingiu o limite de 5 personagens. 
                                <span class="upgrade-link" onclick="window.location.href='premium.html'">
                                    Fa√ßa upgrade para Premium
                                </span> 
                                para criar personagens ilimitados!
                            </div>
                        </div>
                    `;

                    if (window.lucide) lucide.createIcons();
                }

                if (allChars.length === 0) {
                    grid.style.display = 'none';
                    emptyState.style.display = 'block';
                    if (window.lucide) lucide.createIcons();
                    return;
                }

                grid.style.display = 'grid';
                emptyState.style.display = 'none';
                grid.innerHTML = '';

                allChars.forEach(char => {
                    const isActive = activeChar.id === char.id;
                    const card = createCharacterCard(char, isActive);
                    grid.appendChild(card);
                });

                if (window.lucide) lucide.createIcons();
            } catch (err) {
                console.error('Erro ao carregar personagens:', err);
            }
        }

        function createCharacterCard(char, isActive) {
            const card = document.createElement('div');
            card.className = 'char-card' + (isActive ? ' active' : '');

            const breathingIcons = {
                '√Ågua': 'droplet',
                'Chama': 'flame',
                'Trov√£o': 'zap',
                'Vento': 'wind',
                'Pedra': 'mountain',
                'N√©voa': 'cloud',
                'Serpente': 'waves',
                'Som': 'music',
                'Inseto': 'bug',
                'Flor': 'flower-2'
            };

            const breathingIcon = breathingIcons[char.breathing] || 'wind';
            const isOni = char.race === 'Oni';

            card.innerHTML = `
                ${isOni ? '<div style="position:absolute; top:1rem; left:1rem; background:linear-gradient(90deg, #d90429, #c1121f); color:white; padding:0.4rem 1rem; border-radius:20px; font-size:0.75rem; font-weight:700; z-index:2; display:flex; align-items:center; gap:6px;"><i data-lucide="skull" style="width:12px;"></i>ONI</div>' : ''}
                <div class="char-header">
                    <div class="char-name">${char.name || 'Sem Nome'}</div>
                    <div class="char-meta">
                        <div class="char-meta-item">
                            <i data-lucide="user" style="width:14px;"></i>
                            <span>${char.race || 'Humano'}</span>
                        </div>
                        <div class="char-meta-item">
                            <i data-lucide="star" style="width:14px;"></i>
                            <span>N√≠vel ${char.level || 1}</span>
                        </div>
                        <div class="char-meta-item">
                            <i data-lucide="award" style="width:14px;"></i>
                            <span>${char.rank || 'Mizunoto'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="char-body">
                    <div class="char-stats">
                        <div class="stat-box">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">${char.hp || 0}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">PE</div>
                            <div class="stat-value">${char.pe || 0}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">XP</div>
                            <div class="stat-value">${char.xp || 0}</div>
                        </div>
                    </div>
                    
                    <div class="char-breathing">
                        ${isOni ?
                    '<i data-lucide="flame" style="width:24px;"></i>' :
                    `<i data-lucide="${breathingIcon}" style="width:24px;"></i>`
                }
                        <div class="char-breathing-text">
                            <div class="char-breathing-label">${isOni ? 'Kekkijutsu' : 'Respira√ß√£o'}</div>
                            <div class="char-breathing-name">${isOni ? (char.kekkijutsu || 'Em breve') : (char.breathing || 'Nenhuma')}</div>
                        </div>
                    </div>
                    
                    <div class="char-actions">
                        <button class="char-btn char-btn-primary" data-action="select" data-id="${char.id}">
                            <i data-lucide="play" style="width:16px;"></i>
                            ${isActive ? 'Continuar' : 'Selecionar'}
                        </button>
                        <button class="char-btn char-btn-secondary" data-action="view" data-id="${char.id}">
                            <i data-lucide="eye" style="width:16px;"></i>
                            Ver
                        </button>
                        <button class="char-btn char-btn-danger" data-action="delete" data-id="${char.id}">
                            <i data-lucide="trash-2" style="width:16px;"></i>
                        </button>
                    </div>
                </div>
            `;

            // Add event listeners to buttons
            const selectBtn = card.querySelector('[data-action="select"]');
            const viewBtn = card.querySelector('[data-action="view"]');
            const deleteBtn = card.querySelector('[data-action="delete"]');

            if (selectBtn) {
                selectBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectCharacter(char.id);
                });
            }

            if (viewBtn) {
                viewBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    viewCharacter(char.id);
                });
            }

            if (deleteBtn) {
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteCharacter(char.id, char.name);
                });
            }

            return card;
        }

        function createNewCharacter() {
            const allChars = JSON.parse(localStorage.getItem('demonSlayerAllChars') || '[]');
            if (allChars.length >= 5) {
                if (confirm('Voc√™ atingiu o limite de 5 personagens.\n\nDeseja fazer upgrade para Premium e ter personagens ilimitados?')) {
                    window.location.href = 'premium.html';
                }
                return;
            }
            window.location.href = 'create-character.html';
        }

        function selectCharacter(id) {
            try {
                console.log('Selecionando personagem:', id);
                const allChars = JSON.parse(localStorage.getItem('demonSlayerAllChars') || '[]');
                const char = allChars.find(c => c.id === id);

                if (char) {
                    localStorage.setItem('demonSlayerChar', JSON.stringify(char));
                    console.log('Personagem selecionado:', char.name);

                    // Show feedback
                    const feedback = document.createElement('div');
                    const isOni = char.race === 'Oni';

                    feedback.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0, 0, 0, 0.95);
                        border: 2px solid ${isOni ? 'var(--accent-red)' : 'var(--accent-cyan)'};
                        border-radius: 12px;
                        padding: 2rem;
                        z-index: 9999;
                        text-align: center;
                        color: white;
                    `;
                    feedback.innerHTML = `
                        <div style="font-size: 3rem; margin-bottom: 1rem;">${isOni ? 'üëπ' : '‚öîÔ∏è'}</div>
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">
                            ${char.name}
                        </div>
                        <div style="color: rgba(255,255,255,0.6);">
                            Entrando no dashboard...
                        </div>
                    `;
                    document.body.appendChild(feedback);

                    setTimeout(() => {
                        // Redirect to appropriate dashboard
                        if (isOni) {
                            window.location.href = 'oni-dashboard.html';
                        } else {
                            window.location.href = 'dashboard.html';
                        }
                    }, 800);
                } else {
                    alert('Erro: Personagem n√£o encontrado');
                }
            } catch (err) {
                console.error('Erro ao selecionar personagem:', err);
                alert('Erro ao selecionar personagem: ' + err.message);
            }
        }

        function viewCharacter(id) {
            console.log('Visualizando personagem:', id);
            selectCharacter(id);
        }

        function deleteCharacter(id, name) {
            try {
                console.log('Deletando personagem:', id, name);

                if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO\n\nTem certeza que deseja deletar "${name}"?\n\nEsta a√ß√£o n√£o pode ser desfeita e voc√™ perder√°:\n‚Ä¢ Todos os itens\n‚Ä¢ Todo o progresso\n‚Ä¢ Todas as t√©cnicas\n\nDeseja continuar?`)) {
                    return;
                }

                const allChars = JSON.parse(localStorage.getItem('demonSlayerAllChars') || '[]');
                const filtered = allChars.filter(c => c.id !== id);
                localStorage.setItem('demonSlayerAllChars', JSON.stringify(filtered));

                console.log('Personagem deletado. Restantes:', filtered.length);

                // Check if active char was deleted
                const active = JSON.parse(localStorage.getItem('demonSlayerChar') || '{}');
                if (active.id === id) {
                    localStorage.removeItem('demonSlayerChar');
                    console.log('Personagem ativo removido');
                }

                // Show feedback
                const feedback = document.createElement('div');
                feedback.style.cssText = `
                    position: fixed;
                    top: 2rem;
                    right: 2rem;
                    background: rgba(217, 4, 41, 0.95);
                    border: 1px solid var(--accent-red);
                    border-radius: 8px;
                    padding: 1rem 1.5rem;
                    z-index: 9999;
                    font-weight: 600;
                    color: white;
                `;
                feedback.textContent = `‚úì ${name} foi deletado`;
                document.body.appendChild(feedback);

                setTimeout(() => {
                    feedback.remove();
                }, 3000);

                // Reload characters
                loadCharacters();
            } catch (err) {
                console.error('Erro ao deletar personagem:', err);
                alert('Erro ao deletar personagem: ' + err.message);
            }
        }

        // Load on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('P√°gina carregada, carregando personagens...');
            loadCharacters();
        });
    </script>
</body>

</html>