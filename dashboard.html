<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Caçador | Demon Slayer RPG</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Cinzel:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="oni-dashboard.css">
    <link rel="stylesheet" href="nichirin_forge.css">
    <link rel="stylesheet" href="breathing.css">

    <style>
        :root {
            --accent-primary: #00b4d8;
            --accent-glow: #0077b6;
        }

        .nav-item.active {
            border-right: 3px solid var(--accent-primary);
            background: linear-gradient(90deg, rgba(0, 180, 216, 0.1), transparent);
        }

        .sec-title {
            color: white;
            text-shadow: 0 0 10px rgba(0, 180, 216, 0.5);
        }

        #wisteria-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background: radial-gradient(circle at 50% 20%, rgba(157, 78, 221, 0.15), transparent 60%);
        }

        .petal {
            position: absolute;
            background: #e0aaff;
            border-radius: 100% 0 100% 0;
            opacity: 0.6;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translate(0, -10vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            100% {
                transform: translate(20px, 110vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Hunter Specifics */
        .lvl-btn {
            background: #222;
            border: 1px solid #444;
            color: #fff;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
        }

        .lvl-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        /* Basic form card fallbacks if CSS fails loading */
        .form-card {
            background: #111;
            border: 1px solid #333;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .form-use-btn {
            width: 100%;
            background: rgba(0, 180, 216, 0.2);
            border: 1px solid var(--accent-primary);
            color: white;
            padding: 5px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 4px;
        }

        .form-use-btn:hover {
            background: var(--accent-primary);
        }

        .attack-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #16161a;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 5px;
            border: 1px solid #333;
        }

        .atk-info {
            display: flex;
            flex-direction: column;
        }

        .atk-name {
            font-weight: bold;
            color: white;
        }

        .atk-meta {
            font-size: 0.8rem;
            color: #888;
        }

        .roll-atk-btn {
            background: #d90429;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }

        .del-atk-btn {
            background: #333;
            color: #888;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="wisteria-bg"></div>

    <aside class="sidebar-left">
        <div class="app-logo">
            <i data-lucide="sword" color="#00b4d8"></i>
            <span>DEMON<br>SLAYER</span>
        </div>

        <nav class="nav-steps">
            <div class="nav-item active" id="nav-overview" onclick="showSection('overview')">
                <i data-lucide="layout-dashboard"></i>
                <span>Visão Geral</span>
            </div>
            <div class="nav-item" id="nav-inventory" onclick="showSection('inventory')">
                <i data-lucide="backpack"></i>
                <span>Inventário</span>
            </div>
            <div class="nav-item" id="nav-skills" onclick="showSection('skills')">
                <i data-lucide="wind"></i>
                <span>Respiração</span>
            </div>
            <div class="nav-item" id="nav-attacks" onclick="showSection('attacks')">
                <i data-lucide="swords" color="#d90429"></i>
                <span>Combate</span>
            </div>
            <div class="nav-item" id="nav-forge" onclick="showSection('forge')">
                <i data-lucide="hammer" color="#ffd700"></i>
                <span style="color:#ffd700;">Forja Nichirin</span>
            </div>
            <div class="nav-item" id="nav-store" onclick="showSection('store')">
                <i data-lucide="shopping-bag" color="#e0aaff"></i>
                <span style="color:#e0aaff;">Loja Premium</span>
            </div>
        </nav>

        <div style="margin-top:auto">
            <button class="devour-btn" onclick="window.location.href='index.html'"
                style="text-align:center; border-color:#333;">
                <i data-lucide="log-out"></i> SAIR
            </button>
        </div>
    </aside>

    <main class="main-content">

        <!-- SECTION: OVERVIEW -->
        <section id="overview" class="dashboard-section active-tab">
            <div class="section-header">
                <span class="sec-title">Painel do Caçador</span>
                <i data-lucide="activity" color="#00b4d8"></i>
            </div>

            <div
                style="background: rgba(0,180,216,0.1); border: 1px solid #00b4d8; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                <h2 style="margin:0; font-size:1.2rem; color: #00b4d8;">Bem-vindo, Caçador.</h2>
                <p style="margin:0.5rem 0 0 0; font-size:0.9rem; color: #ccc;">Sua jornada para destruir os onis começa
                    aqui.</p>
            </div>

            <div class="attributes-grid" id="attrGrid"></div>
        </section>

        <!-- SECTION: INVENTORY -->
        <section id="inventory" class="dashboard-section">
            <div class="section-header">
                <span class="sec-title">Inventário</span>
                <i data-lucide="backpack" color="#00b4d8"></i>
            </div>

            <div class="inventory-controls">
                <button class="devour-btn" style="width:auto; margin:0; border-color:#00b4d8; color:#00b4d8;"
                    onclick="openItemModal()">
                    <i data-lucide="plus"></i> Adicionar Item
                </button>
            </div>

            <div class="inv-workspace">
                <div class="inv-list-container" id="inventoryGrid"></div>
            </div>
        </section>

        <!-- SECTION: BREATHING -->
        <section id="skills" class="dashboard-section">
            <div class="section-header">
                <span class="sec-title">Técnicas de Respiração</span>
                <i data-lucide="wind" color="#00b4d8"></i>
            </div>

            <div id="breathingLocked" style="text-align:center; padding:3rem; color:#666;">
                <i data-lucide="lock" size="48" style="margin-bottom:1rem; opacity:0.5;"></i>
                <p>As Técnicas de Respiração são desbloqueadas no <strong>Nível 3</strong>.</p>
            </div>

            <div id="breathingUnlocked" style="display:none;">
                <div class="breathing-header" style="margin-bottom:10px;">
                    <h2 id="breathStyleName" style="color:var(--accent-primary); margin:0;">Respiração da Água</h2>
                    <div style="font-size:0.9rem; color:#888;">Pontos de Energia: <span id="peDisplay">0 / 0</span>
                    </div>
                </div>
                <div class="forms-grid" id="formsGrid"
                    style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:10px;">
                    <!-- JS Injected Forms -->
                </div>
            </div>
        </section>

        <!-- SECTION: ATTACKS -->
        <section id="attacks" class="dashboard-section">
            <div class="section-header">
                <span class="sec-title">Ataques & Combate</span>
                <i data-lucide="swords" color="#d90429"></i>
            </div>
            <div class="atk-controls" style="margin-bottom:1rem;">
                <button class="devour-btn" style="width:auto; margin:0;" onclick="openAttackModal()">+ Novo
                    Ataque</button>
            </div>
            <div id="attacksList"></div>
        </section>

        <!-- SECTION: FORGE -->
        <section id="forge" class="dashboard-section">
            <div class="section-header">
                <span class="sec-title" style="color:#ffd700">Forja Nichirin</span>
            </div>
            <div class="nichirin-wrapper">
                <div class="heat-glow"></div>
                <div class="sword-stage">
                    <div class="sword-container">
                        <div class="blade" id="swordBlade"></div>
                        <div class="habaki"></div>
                        <div class="tsuba"></div>
                        <div class="tsuka"></div>
                    </div>
                </div>
                <div class="forge-ui">
                    <div class="controls-row">
                        <select id="elementSelect" class="element-select"></select>
                        <button id="forgeBtn" class="forge-btn" onclick="startForging()">FORJAR</button>
                    </div>
                    <h2 id="resultTitle" style="color:white; margin-top:10px;"></h2>
                    <div id="resultDesc" style="color:#888;"></div>
                </div>
            </div>
        </section>

        <!-- SECTION: STORE (PREMIUM) -->
        <section id="store" class="dashboard-section">
            <div class="section-header">
                <span class="sec-title" style="color:#e0aaff">Loja Premium</span>
                <i data-lucide="shopping-bag" color="#e0aaff"></i>
            </div>

            <div
                style="background:linear-gradient(90deg, #240046, #3c096c); padding:2rem; border-radius:12px; margin-bottom:2rem; text-align:center; position:relative; overflow:hidden;">
                <div style="position:relative; z-index:2;">
                    <h2 style="font-family:'Cinzel', serif; font-size:2rem; margin:0 0 10px 0; color:#e0aaff;">Passe
                        Hashira</h2>
                    <p style="color:#c77dff; max-width:600px; margin:0 auto;">Desbloqueie estilos de respiração
                        lendários, personalização avançada de Nichirin e suporte o desenvolvimento do sistema.</p>
                    <button class="forge-btn"
                        style="margin-top:20px; background:#e0aaff; color:#10002b; font-weight:800;"
                        onclick="buyPremium()">ADQUIRIR AGORA</button>
                </div>
                <!-- Decor -->
                <i data-lucide="crown" size="120"
                    style="position:absolute; top:-20px; right:-20px; opacity:0.1; color:#fff;"></i>
            </div>

            <div class="store-grid" id="storeGrid"
                style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
                <!-- JS Populated -->
            </div>
        </section>

    </main>

    <div id="toastContainer"
        style="position:fixed; bottom:20px; right:20px; z-index:9999; display:flex; flex-direction:column; gap:10px;">
    </div>

    <!-- ATTACK MODAL -->
    <div id="attackModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
        <div class="modal-content"
            style="background:#111; padding:2rem; width:400px; border:1px solid #333; border-radius:10px;">
            <h2 style="margin-top:0;">Novo Ataque</h2>
            <div style="margin-bottom:10px;">
                <label>Nome:</label>
                <input type="text" id="atkNameInput" class="ds-input"
                    style="width:100%; padding:5px; background:#222; border:1px solid #444; color:white;">
            </div>
            <div style="margin-bottom:10px;">
                <label>Dano (Ex: 1d8+2):</label>
                <input type="text" id="atkDmgInput" class="ds-input"
                    style="width:100%; padding:5px; background:#222; border:1px solid #444; color:white;">
            </div>
            <div style="margin-bottom:10px;">
                <label>Tipo (Ex: Cortante):</label>
                <input type="text" id="atkTypeInput" class="ds-input"
                    style="width:100%; padding:5px; background:#222; border:1px solid #444; color:white;">
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button onclick="closeAttackModal()"
                    style="padding:8px 16px; background:#333; color:white; border:none; cursor:pointer;">Cancelar</button>
                <button onclick="confirmAddAttack()"
                    style="padding:8px 16px; background:#00b4d8; color:white; border:none; cursor:pointer;">Criar</button>
            </div>
        </div>
    </div>

    <!-- ITEM MODAL -->
    <div id="itemModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
        <div class="modal-content"
            style="background:#111; padding:2rem; width:600px; max-height:80vh; overflow:auto; border:1px solid #333; border-radius:10px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;">
                <h2>Adicionar Item</h2>
                <span style="cursor:pointer;" onclick="closeItemModal()">X</span>
            </div>
            <input type="text" class="ds-input" id="itemSearch" placeholder="Buscar..."
                style="width:100%; padding:10px; margin-bottom:10px; background:#222; border:1px solid #333; color:white;">
            <div id="pickerGrid"
                style="display:grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap:10px;"></div>
        </div>
    </div>

    <!-- COMBAT RESULT MODAL -->
    <div id="combatResultModal" style="display:none;" class="modal-overlay">
        <div class="combat-modal-content">
            <div class="combat-header">
                <h2 id="combatTitle" style="margin:0; font-family:'Cinzel', serif;">Técnica Executada</h2>
                <div class="close-combat" onclick="closeCombatModal()" style="cursor:pointer;">
                    <i data-lucide="x"></i>
                </div>
            </div>
            <div class="combat-body" style="text-align:center; padding:2rem;">
                <div class="combat-roll-container">
                    <span id="combatRollTotal" class="roll-total"
                        style="font-size:4rem; font-weight:800; color:#fff; text-shadow:0 0 20px rgba(255,255,255,0.5);">0</span>
                    <div id="combatRollExpr" class="roll-expr" style="font-size:1.2rem; color:#888; margin-top:5px;">...
                    </div>
                </div>
                <div class="combat-details" id="combatDetails" style="margin-top:20px; font-size:1.1rem; color:#aaa;">
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS ORDER IS CRITICAL -->
    <script src="items_db.js"></script>
    <script src="inventory_modules.js"></script>
    <script src="hunters_algorithm.js"></script>
    <script src="breathing_db.js"></script> <!-- Water Breathing -->
    <script src="nichirin_system.js"></script>
    <script src="dashboard.js"></script>

    <script>
        // Init logic wrapper
        function showSection(id) {
            document.querySelectorAll('.dashboard-section').forEach(s => s.classList.remove('active-tab'));
            const t = document.getElementById(id);
            if (t) t.classList.add('active-tab');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const n = document.getElementById('nav-' + id);
            if (n) n.classList.add('active');
            if (window.lucide) lucide.createIcons();
        }

        function initWisteria() {
            const c = document.getElementById('wisteria-bg');
            if (!c) return;
            for (let i = 0; i < 30; i++) {
                const p = document.createElement('div');
                p.className = 'petal';
                p.style.left = Math.random() * 100 + '%';
                p.style.width = (Math.random() * 5 + 5) + 'px';
                p.style.height = p.style.width;
                p.style.animationDuration = (Math.random() * 5 + 5) + 's';
                p.style.animationDelay = (Math.random() * 5) + 's';
                c.appendChild(p);
            }
        }

        window.onload = function () {
            initWisteria();
            if (window.lucide) lucide.createIcons();
        };
    </script>
</body>

</html>